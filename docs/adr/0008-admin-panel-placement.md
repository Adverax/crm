# ADR-0008: Размещение админ-панели в монорепозитории

**Статус:** Принято
**Дата:** 2026-02-08
**Участники:** @roman_myakotin

## Контекст

CRM-платформа нуждается в административном интерфейсе (аналог Salesforce Setup) для:
- Управления метаданными (объекты, поля, layouts)
- Управления безопасностью (профили, роли, OLS/FLS/RLS)
- Управления пользователями и организацией
- Мониторинга и настроек платформы

Админка и пользовательский CRM-интерфейс — разные функциональные области с разными целевыми
аудиториями (администраторы vs операторы), но работают с одним бэкендом и одной моделью
авторизации (JWT + профили).

Необходимо определить, где в монорепозитории разместить код админки.

## Рассмотренные варианты

### Вариант A: Маршруты внутри `web/` (выбран)

Админка размещается как набор маршрутов `/admin/*` внутри существующего Vue-приложения `web/`.
Отдельный layout, lazy-loaded views, guard по профилю пользователя.

```
web/src/
├── layouts/
│   ├── DefaultLayout.vue      ← CRM layout
│   └── AdminLayout.vue        ← Admin layout
├── views/
│   ├── admin/                 ← админка
│   │   ├── metadata/
│   │   ├── security/
│   │   └── users/
│   ├── contacts/              ← CRM
│   ├── deals/
│   └── ...
```

**Плюсы:**
- Один билд, один деплой, один домен — минимум инфраструктурного оверхеда
- Общие компоненты, stores, API-клиент, типы — без дублирования
- Общий auth flow (JWT, один guard по профилю)
- Lazy-loading маршрутов решает проблему размера бандла
- Простая миграция: если админка разрастётся, `views/admin/` легко вынести в отдельное приложение

**Минусы:**
- Нельзя деплоить админку отдельно от CRM
- Нельзя ограничить доступ на уровне инфраструктуры (отдельный домен, VPN)
- Со временем `web/` может стать большим

### Вариант B: Отдельное приложение `admin/`

Полностью отдельное Vue-приложение в корне монорепо.

```
crm/
├── web/        ← CRM frontend
├── admin/      ← Admin frontend (отдельный package.json)
```

**Плюсы:** полная изоляция, независимый деплой, можно ограничить доступ на infra-уровне.
**Минусы:** дублирование зависимостей, типов, API-клиента; два CI-пайплайна; два билда.

### Вариант C: npm workspaces (monorepo frontend)

```
web/
├── apps/crm/       ← CRM
├── apps/admin/     ← Admin
├── packages/shared/ ← общие типы, UI, API-клиент
```

**Плюсы:** изоляция + переиспользование через shared-пакеты.
**Минусы:** значительный инфраструктурный оверхед (workspace config, shared package builds),
оправдан только для больших команд.

## Решение

Принимаем **Вариант A** — маршруты внутри `web/`.

### Обоснование

1. **MVP-прагматика** — на текущей стадии (один разработчик, Phase 1) оверхед отдельного
   приложения не оправдан
2. **Единый бэкенд** — один API-сервер (`cmd/api`), один JWT — логично один фронтенд
3. **Контроль доступа через профили** — доступ к `/admin/*` контролируется Vue Router guard
   на основе профиля пользователя, что согласуется с OLS-моделью безопасности (Phase 2)
4. **Lazy-loading** — admin-модули загружаются только при навигации в `/admin/*`,
   не влияют на размер начального бандла для обычных пользователей

### Конвенции

- Все admin-маршруты: `/admin/*`
- Отдельный layout: `AdminLayout.vue`
- Views: `web/src/views/admin/{module}/`
- Компоненты, специфичные для админки: `web/src/components/admin/`
- Router guard: проверка профиля/роли перед рендером admin-маршрутов

### Критерий миграции на Вариант C

Переход к workspaces оправдан, когда:
- Админка превысит ~30 views
- Появится отдельная команда фронтенд-разработчиков для админки
- Потребуется независимый деплой (отдельный домен, VPN)

## Последствия

- Админка живёт в `web/src/views/admin/` как часть основного Vue-приложения
- Доступ контролируется на уровне маршрутов (guard), а не инфраструктуры
- Общие компоненты и stores переиспользуются без дублирования
- При росте проекта возможна миграция на workspace-структуру без потери кода
