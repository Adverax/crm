openapi: "3.0.3"
info:
  title: CRM Platform API
  version: 0.1.0
  description: Enterprise CRM platform with metadata-driven objects and granular security.

servers:
  - url: http://localhost:8080
    description: Local development

tags:
  - name: system
    description: System health and diagnostics
  - name: auth
    description: Authentication and authorization
  - name: metadata-objects
    description: Object definition management
  - name: metadata-fields
    description: Field definition management
  - name: soql
    description: SOQL query execution
  - name: dml
    description: DML statement execution
  - name: templates
    description: Application template management
  - name: validation-rules
    description: Validation rule management
  - name: functions
    description: Custom function management
  - name: object-views
    description: Object view management
  - name: cel
    description: CEL expression validation
  - name: profile-navigation
    description: Profile navigation management (sidebar config per profile)
  - name: views
    description: Object view resolution by API name

paths:
  /healthz:
    get:
      summary: Health check
      operationId: healthCheck
      tags:
        - system
      responses:
        "200":
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok

  /api/v1/auth/login:
    post:
      summary: Authenticate user
      operationId: login
      tags:
        - auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginRequest"
      responses:
        "200":
          description: Authentication successful
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TokenPairResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/v1/auth/refresh:
    post:
      summary: Refresh access token
      operationId: refreshToken
      tags:
        - auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RefreshRequest"
      responses:
        "200":
          description: Token refreshed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TokenPairResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/v1/auth/logout:
    post:
      summary: Logout (revoke refresh token)
      operationId: logout
      tags:
        - auth
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                refresh_token:
                  type: string
      responses:
        "204":
          description: Logged out
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/v1/auth/me:
    get:
      summary: Get current user info
      operationId: getMe
      tags:
        - auth
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Current user
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserInfoResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/v1/auth/forgot-password:
    post:
      summary: Request password reset
      operationId: forgotPassword
      tags:
        - auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ForgotPasswordRequest"
      responses:
        "200":
          description: If the email exists, a reset link has been sent
        "400":
          $ref: "#/components/responses/BadRequest"

  /api/v1/auth/reset-password:
    post:
      summary: Reset password with token
      operationId: resetPassword
      tags:
        - auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ResetPasswordRequest"
      responses:
        "200":
          description: Password has been reset
        "400":
          $ref: "#/components/responses/BadRequest"

  /api/v1/admin/security/users/{userId}/password:
    parameters:
      - name: userId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    put:
      summary: Set user password (admin)
      operationId: setUserPassword
      tags:
        - auth
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SetPasswordRequest"
      responses:
        "200":
          description: Password updated
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/admin/metadata/objects:
    post:
      summary: Create object definition
      operationId: createObject
      tags:
        - metadata-objects
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateObjectRequest"
      responses:
        "201":
          description: Object created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ObjectResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalError"

    get:
      summary: List object definitions
      operationId: listObjects
      tags:
        - metadata-objects
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
            minimum: 1
        - name: per_page
          in: query
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
        - name: object_type
          in: query
          schema:
            type: string
            enum: [standard, custom]
      responses:
        "200":
          description: List of objects
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ObjectListResponse"
        "500":
          $ref: "#/components/responses/InternalError"

  /api/v1/admin/metadata/objects/{objectId}:
    parameters:
      - $ref: "#/components/parameters/ObjectId"

    get:
      summary: Get object definition
      operationId: getObject
      tags:
        - metadata-objects
      responses:
        "200":
          description: Object definition
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ObjectResponse"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

    put:
      summary: Update object definition
      operationId: updateObject
      tags:
        - metadata-objects
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateObjectRequest"
      responses:
        "200":
          description: Object updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ObjectResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

    delete:
      summary: Delete object definition
      operationId: deleteObject
      tags:
        - metadata-objects
      responses:
        "204":
          description: Object deleted
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /api/v1/admin/metadata/objects/{objectId}/fields:
    parameters:
      - $ref: "#/components/parameters/ObjectId"

    post:
      summary: Create field definition
      operationId: createField
      tags:
        - metadata-fields
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateFieldRequest"
      responses:
        "201":
          description: Field created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FieldResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalError"

    get:
      summary: List field definitions for object
      operationId: listFields
      tags:
        - metadata-fields
      responses:
        "200":
          description: List of fields
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FieldListResponse"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /api/v1/admin/metadata/objects/{objectId}/fields/{fieldId}:
    parameters:
      - $ref: "#/components/parameters/ObjectId"
      - $ref: "#/components/parameters/FieldId"

    get:
      summary: Get field definition
      operationId: getField
      tags:
        - metadata-fields
      responses:
        "200":
          description: Field definition
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FieldResponse"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

    put:
      summary: Update field definition
      operationId: updateField
      tags:
        - metadata-fields
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateFieldRequest"
      responses:
        "200":
          description: Field updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FieldResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

    delete:
      summary: Delete field definition
      operationId: deleteField
      tags:
        - metadata-fields
      responses:
        "204":
          description: Field deleted
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /api/v1/query:
    get:
      summary: Execute SOQL query (GET)
      operationId: executeQueryGet
      tags:
        - soql
      parameters:
        - name: q
          in: query
          required: true
          description: SOQL query string
          schema:
            type: string
          example: "SELECT Id, Name FROM Account WHERE Name = 'Acme'"
      responses:
        "200":
          description: Query result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SOQLResult"
        "400":
          $ref: "#/components/responses/BadRequest"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/InternalError"

    post:
      summary: Execute SOQL query (POST)
      operationId: executeQueryPost
      tags:
        - soql
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SOQLRequest"
      responses:
        "200":
          description: Query result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SOQLResult"
        "400":
          $ref: "#/components/responses/BadRequest"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/InternalError"

  /api/v1/data:
    post:
      summary: Execute DML statement
      operationId: executeDML
      tags:
        - dml
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/DMLRequest"
      responses:
        "200":
          description: DML result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DMLResult"
        "400":
          $ref: "#/components/responses/BadRequest"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/InternalError"

  /api/v1/admin/templates:
    get:
      summary: List available application templates
      operationId: listTemplates
      tags:
        - templates
      security:
        - BearerAuth: []
      responses:
        "200":
          description: List of templates
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TemplateListResponse"

  /api/v1/admin/templates/{templateId}/apply:
    parameters:
      - name: templateId
        in: path
        required: true
        schema:
          type: string
    post:
      summary: Apply an application template
      operationId: applyTemplate
      tags:
        - templates
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Template applied successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TemplateApplyResponse"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalError"

  /api/v1/describe:
    get:
      summary: List accessible objects for navigation
      operationId: listDescribeObjects
      tags:
        - describe
      security:
        - BearerAuth: []
      responses:
        "200":
          description: List of queryable objects
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/ObjectNavItem"

  /api/v1/describe/{objectName}:
    parameters:
      - name: objectName
        in: path
        required: true
        schema:
          type: string
    get:
      summary: Describe object with fields
      operationId: describeObject
      tags:
        - describe
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Object description with fields
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/ObjectDescribe"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/records/{objectName}:
    parameters:
      - name: objectName
        in: path
        required: true
        schema:
          type: string
    get:
      summary: List records for an object
      operationId: listRecords
      tags:
        - records
      security:
        - BearerAuth: []
      parameters:
        - $ref: "#/components/parameters/Page"
        - $ref: "#/components/parameters/PerPage"
      responses:
        "200":
          description: Paginated list of records
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      additionalProperties: true
                  pagination:
                    $ref: "#/components/schemas/PaginationMeta"
        "404":
          $ref: "#/components/responses/NotFound"
    post:
      summary: Create a record
      operationId: createRecord
      tags:
        - records
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              additionalProperties: true
      responses:
        "201":
          description: Record created
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      id:
                        type: string
        "400":
          $ref: "#/components/responses/BadRequest"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/records/{objectName}/{recordId}:
    parameters:
      - name: objectName
        in: path
        required: true
        schema:
          type: string
      - name: recordId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    get:
      summary: Get a record by ID
      operationId: getRecord
      tags:
        - records
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Record data
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    additionalProperties: true
        "404":
          $ref: "#/components/responses/NotFound"
    put:
      summary: Update a record
      operationId: updateRecord
      tags:
        - records
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              additionalProperties: true
      responses:
        "200":
          description: Record updated
        "400":
          $ref: "#/components/responses/BadRequest"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
    delete:
      summary: Delete a record
      operationId: deleteRecord
      tags:
        - records
      security:
        - BearerAuth: []
      responses:
        "204":
          description: Record deleted
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/admin/metadata/objects/{objectId}/rules:
    parameters:
      - $ref: "#/components/parameters/ObjectId"
    get:
      summary: List validation rules for object
      operationId: listValidationRules
      tags:
        - validation-rules
      security:
        - BearerAuth: []
      responses:
        "200":
          description: List of validation rules
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ValidationRuleListResponse"
        "404":
          $ref: "#/components/responses/NotFound"
    post:
      summary: Create validation rule
      operationId: createValidationRule
      tags:
        - validation-rules
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateValidationRuleRequest"
      responses:
        "201":
          description: Validation rule created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ValidationRuleResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"

  /api/v1/admin/metadata/objects/{objectId}/rules/{ruleId}:
    parameters:
      - $ref: "#/components/parameters/ObjectId"
      - $ref: "#/components/parameters/RuleId"
    get:
      summary: Get validation rule
      operationId: getValidationRule
      tags:
        - validation-rules
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Validation rule
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ValidationRuleResponse"
        "404":
          $ref: "#/components/responses/NotFound"
    put:
      summary: Update validation rule
      operationId: updateValidationRule
      tags:
        - validation-rules
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateValidationRuleRequest"
      responses:
        "200":
          description: Validation rule updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ValidationRuleResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
    delete:
      summary: Delete validation rule
      operationId: deleteValidationRule
      tags:
        - validation-rules
      security:
        - BearerAuth: []
      responses:
        "204":
          description: Validation rule deleted
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/admin/functions:
    get:
      summary: List all custom functions
      operationId: listFunctions
      tags:
        - functions
      security:
        - BearerAuth: []
      responses:
        "200":
          description: List of functions
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Function"
    post:
      summary: Create a custom function
      operationId: createFunction
      tags:
        - functions
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateFunctionRequest"
      responses:
        "201":
          description: Function created
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Function"
        "400":
          $ref: "#/components/responses/BadRequest"
        "409":
          $ref: "#/components/responses/Conflict"

  /api/v1/admin/functions/{functionId}:
    parameters:
      - $ref: "#/components/parameters/FunctionId"
    get:
      summary: Get a custom function by ID
      operationId: getFunction
      tags:
        - functions
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Function details
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Function"
        "404":
          $ref: "#/components/responses/NotFound"
    put:
      summary: Update a custom function
      operationId: updateFunction
      tags:
        - functions
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateFunctionRequest"
      responses:
        "200":
          description: Function updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Function"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
    delete:
      summary: Delete a custom function
      operationId: deleteFunction
      tags:
        - functions
      security:
        - BearerAuth: []
      responses:
        "204":
          description: Function deleted
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"

  /api/v1/admin/object-views:
    get:
      summary: List object views
      operationId: listObjectViews
      tags:
        - object-views
      security:
        - BearerAuth: []
      parameters:
        - name: object_id
          in: query
          required: false
          description: Filter by object ID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: List of object views
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/ObjectView"
        "400":
          $ref: "#/components/responses/BadRequest"
    post:
      summary: Create an object view
      operationId: createObjectView
      tags:
        - object-views
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateObjectViewRequest"
      responses:
        "201":
          description: Object view created
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/ObjectView"
        "400":
          $ref: "#/components/responses/BadRequest"
        "409":
          $ref: "#/components/responses/Conflict"

  /api/v1/admin/object-views/{viewId}:
    parameters:
      - $ref: "#/components/parameters/ViewId"
    get:
      summary: Get an object view by ID
      operationId: getObjectView
      tags:
        - object-views
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Object view details
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/ObjectView"
        "404":
          $ref: "#/components/responses/NotFound"
    put:
      summary: Update an object view
      operationId: updateObjectView
      tags:
        - object-views
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateObjectViewRequest"
      responses:
        "200":
          description: Object view updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/ObjectView"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
    delete:
      summary: Delete an object view
      operationId: deleteObjectView
      tags:
        - object-views
      security:
        - BearerAuth: []
      responses:
        "204":
          description: Object view deleted
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"

  /api/v1/admin/cel/validate:
    post:
      summary: Validate a CEL expression
      operationId: validateCelExpression
      tags:
        - cel
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CelValidateRequest"
      responses:
        "200":
          description: Validation result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CelValidateResponse"

  # ─── SOQL Validation ─────────────────────────────────────────

  /api/v1/admin/soql/validate:
    post:
      summary: Validate a SOQL query
      operationId: validateSoqlQuery
      tags:
        - soql
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SoqlValidateRequest"
      responses:
        "200":
          description: Validation result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SoqlValidateResponse"

  /api/v1/admin/soql/test:
    post:
      summary: Execute a SOQL query for testing (no security enforcement)
      operationId: testSoqlQuery
      tags:
        - soql
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - query
              properties:
                query:
                  type: string
                pageSize:
                  type: integer
                  default: 5
                  maximum: 20
      responses:
        "200":
          description: Query execution result
          content:
            application/json:
              schema:
                type: object
                properties:
                  totalSize:
                    type: integer
                  records:
                    type: array
                    items:
                      type: object
                      additionalProperties: true
                  error:
                    type: string

  /api/v1/admin/soql/objects:
    get:
      summary: List all queryable objects (no OLS filtering)
      operationId: listSoqlObjects
      tags:
        - soql
      security:
        - BearerAuth: []
      responses:
        "200":
          description: List of queryable objects
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        api_name:
                          type: string
                        label:
                          type: string

  /api/v1/admin/soql/objects/{objectName}/fields:
    get:
      summary: List all fields for an object (no FLS filtering)
      operationId: listSoqlObjectFields
      tags:
        - soql
      security:
        - BearerAuth: []
      parameters:
        - name: objectName
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: List of fields
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        api_name:
                          type: string
                        label:
                          type: string
                        field_type:
                          type: string
        "404":
          description: Object not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # ─── Profile Navigation (Admin CRUD) ──────────────────────────

  /api/v1/admin/profile-navigation:
    get:
      summary: List all profile navigation configs
      operationId: listProfileNavigations
      tags:
        - profile-navigation
      security:
        - BearerAuth: []
      responses:
        "200":
          description: List of navigation configs
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/ProfileNavigation"
    post:
      summary: Create a profile navigation config
      operationId: createProfileNavigation
      tags:
        - profile-navigation
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateProfileNavigationRequest"
      responses:
        "201":
          description: Navigation config created
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/ProfileNavigation"
        "400":
          $ref: "#/components/responses/BadRequest"
        "409":
          $ref: "#/components/responses/Conflict"

  /api/v1/admin/profile-navigation/{navId}:
    parameters:
      - $ref: "#/components/parameters/NavId"
    get:
      summary: Get a profile navigation config by ID
      operationId: getProfileNavigation
      tags:
        - profile-navigation
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Navigation config details
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/ProfileNavigation"
        "404":
          $ref: "#/components/responses/NotFound"
    put:
      summary: Update a profile navigation config
      operationId: updateProfileNavigation
      tags:
        - profile-navigation
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateProfileNavigationRequest"
      responses:
        "200":
          description: Navigation config updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/ProfileNavigation"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
    delete:
      summary: Delete a profile navigation config
      operationId: deleteProfileNavigation
      tags:
        - profile-navigation
      security:
        - BearerAuth: []
      responses:
        "204":
          description: Navigation config deleted
        "404":
          $ref: "#/components/responses/NotFound"

  # ─── Navigation Resolution ──────────────────────────────────

  /api/v1/navigation:
    get:
      summary: Resolve navigation for current user's profile
      description: >
        Returns the resolved sidebar navigation for the authenticated user's profile.
        Object items are filtered by OLS (read permission). If no config exists for the
        profile, returns a fallback with a single "_default" group containing all
        OLS-accessible objects.
      operationId: resolveNavigation
      tags:
        - profile-navigation
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Resolved navigation
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/ResolvedNavigation"
        "401":
          $ref: "#/components/responses/Unauthorized"

  # ─── View Resolution ────────────────────────────────────────

  /api/v1/view/{ovApiName}:
    parameters:
      - name: ovApiName
        in: path
        required: true
        schema:
          type: string
    get:
      summary: Get an object view config by API name
      description: >
        Returns the full object view config for the given API name.
        Used by frontend to render pages assigned via Navigation config.
      operationId: getViewByAPIName
      tags:
        - views
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Object view config
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/ObjectView"
        "404":
          $ref: "#/components/responses/NotFound"
        "401":
          $ref: "#/components/responses/Unauthorized"

  # NOTE: Security endpoints (roles, permission-sets, profiles, users, groups,
  # sharing-rules) are registered manually via SecurityHandler.RegisterRoutes.
  # They are not included in OpenAPI codegen to avoid ServerInterface bloat.

components:
  parameters:
    ObjectId:
      name: objectId
      in: path
      required: true
      schema:
        type: string
        format: uuid

    FieldId:
      name: fieldId
      in: path
      required: true
      schema:
        type: string
        format: uuid

    RuleId:
      name: ruleId
      in: path
      required: true
      schema:
        type: string
        format: uuid

    FunctionId:
      name: functionId
      in: path
      required: true
      schema:
        type: string
        format: uuid

    ViewId:
      name: viewId
      in: path
      required: true
      schema:
        type: string
        format: uuid

    NavId:
      name: navId
      in: path
      required: true
      schema:
        type: string
        format: uuid

    Page:
      name: page
      in: query
      schema:
        type: integer
        default: 1
        minimum: 1

    PerPage:
      name: per_page
      in: query
      schema:
        type: integer
        default: 20
        minimum: 1
        maximum: 100

  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    LoginRequest:
      type: object
      required:
        - username
        - password
      properties:
        username:
          type: string
        password:
          type: string

    RefreshRequest:
      type: object
      required:
        - refresh_token
      properties:
        refresh_token:
          type: string

    ForgotPasswordRequest:
      type: object
      required:
        - email
      properties:
        email:
          type: string
          format: email

    ResetPasswordRequest:
      type: object
      required:
        - token
        - password
      properties:
        token:
          type: string
        password:
          type: string
          minLength: 8
          maxLength: 128

    SetPasswordRequest:
      type: object
      required:
        - password
      properties:
        password:
          type: string
          minLength: 8
          maxLength: 128

    TokenPair:
      type: object
      required:
        - access_token
        - refresh_token
      properties:
        access_token:
          type: string
        refresh_token:
          type: string

    TokenPairResponse:
      type: object
      properties:
        data:
          $ref: "#/components/schemas/TokenPair"

    UserInfo:
      type: object
      required:
        - id
        - username
        - email
        - first_name
        - last_name
        - profile_id
        - is_active
      properties:
        id:
          type: string
          format: uuid
        username:
          type: string
        email:
          type: string
        first_name:
          type: string
        last_name:
          type: string
        profile_id:
          type: string
          format: uuid
        role_id:
          type: string
          format: uuid
          nullable: true
        is_active:
          type: boolean

    UserInfoResponse:
      type: object
      properties:
        data:
          $ref: "#/components/schemas/UserInfo"

    CreateObjectRequest:
      type: object
      required:
        - api_name
        - label
        - plural_label
        - object_type
      properties:
        api_name:
          type: string
          minLength: 2
          maxLength: 100
          example: Invoice__c
        label:
          type: string
          minLength: 1
          example: Invoice
        plural_label:
          type: string
          minLength: 1
          example: Invoices
        description:
          type: string
          default: ""
        object_type:
          type: string
          enum: [standard, custom]
        is_visible_in_setup:
          type: boolean
          default: true
        is_custom_fields_allowed:
          type: boolean
          default: true
        is_deleteable_object:
          type: boolean
          default: true
        is_createable:
          type: boolean
          default: true
        is_updateable:
          type: boolean
          default: true
        is_deleteable:
          type: boolean
          default: true
        is_queryable:
          type: boolean
          default: true
        is_searchable:
          type: boolean
          default: false
        has_activities:
          type: boolean
          default: false
        has_notes:
          type: boolean
          default: false
        has_history_tracking:
          type: boolean
          default: false
        has_sharing_rules:
          type: boolean
          default: false
        visibility:
          type: string
          enum: [private, public_read, public_read_write, controlled_by_parent]
          default: private

    CreateObjectViewRequest:
      type: object
      required:
        - api_name
        - label
      properties:
        profile_id:
          type: string
          format: uuid
          nullable: true
        api_name:
          type: string
          minLength: 2
          maxLength: 100
        label:
          type: string
          minLength: 1
        description:
          type: string
        config:
          $ref: "#/components/schemas/ObjectViewConfig"

    UpdateObjectRequest:
      type: object
      required:
        - label
        - plural_label
      properties:
        label:
          type: string
          minLength: 1
        plural_label:
          type: string
          minLength: 1
        description:
          type: string
        is_visible_in_setup:
          type: boolean
        is_custom_fields_allowed:
          type: boolean
        is_deleteable_object:
          type: boolean
        is_createable:
          type: boolean
        is_updateable:
          type: boolean
        is_deleteable:
          type: boolean
        is_queryable:
          type: boolean
        is_searchable:
          type: boolean
        has_activities:
          type: boolean
        has_notes:
          type: boolean
        has_history_tracking:
          type: boolean
        has_sharing_rules:
          type: boolean
        visibility:
          type: string
          enum: [private, public_read, public_read_write, controlled_by_parent]

    ObjectDefinition:
      type: object
      required:
        - id
        - api_name
        - label
        - plural_label
        - description
        - object_type
        - is_platform_managed
        - is_visible_in_setup
        - is_custom_fields_allowed
        - is_deleteable_object
        - is_createable
        - is_updateable
        - is_deleteable
        - is_queryable
        - is_searchable
        - has_activities
        - has_notes
        - has_history_tracking
        - has_sharing_rules
        - visibility
        - created_at
        - updated_at
      properties:
        id:
          type: string
          format: uuid
        api_name:
          type: string
        label:
          type: string
        plural_label:
          type: string
        description:
          type: string
        object_type:
          type: string
          enum: [standard, custom]
        is_platform_managed:
          type: boolean
        is_visible_in_setup:
          type: boolean
        is_custom_fields_allowed:
          type: boolean
        is_deleteable_object:
          type: boolean
        is_createable:
          type: boolean
        is_updateable:
          type: boolean
        is_deleteable:
          type: boolean
        is_queryable:
          type: boolean
        is_searchable:
          type: boolean
        has_activities:
          type: boolean
        has_notes:
          type: boolean
        has_history_tracking:
          type: boolean
        has_sharing_rules:
          type: boolean
        visibility:
          type: string
          enum: [private, public_read, public_read_write, controlled_by_parent]
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    ObjectResponse:
      type: object
      properties:
        data:
          $ref: "#/components/schemas/ObjectDefinition"

    ObjectListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: "#/components/schemas/ObjectDefinition"
        pagination:
          $ref: "#/components/schemas/PaginationMeta"

    CreateFieldRequest:
      type: object
      required:
        - api_name
        - label
        - field_type
      properties:
        api_name:
          type: string
          minLength: 2
          maxLength: 100
        label:
          type: string
          minLength: 1
        description:
          type: string
          default: ""
        help_text:
          type: string
          default: ""
        field_type:
          type: string
          enum: [text, number, boolean, datetime, picklist, reference]
        field_subtype:
          type: string
          enum: [plain, area, rich, email, phone, url, integer, decimal, currency, percent, auto_number, date, datetime, time, single, multi, association, composition, polymorphic]
        referenced_object_id:
          type: string
          format: uuid
        is_required:
          type: boolean
          default: false
        is_unique:
          type: boolean
          default: false
        config:
          $ref: "#/components/schemas/FieldConfig"
        is_custom:
          type: boolean
          default: false
        sort_order:
          type: integer
          default: 0

    UpdateFieldRequest:
      type: object
      required:
        - label
      properties:
        label:
          type: string
          minLength: 1
        description:
          type: string
        help_text:
          type: string
        is_required:
          type: boolean
        is_unique:
          type: boolean
        config:
          $ref: "#/components/schemas/FieldConfig"
        sort_order:
          type: integer

    FieldConfig:
      type: object
      properties:
        max_length:
          type: integer
        precision:
          type: integer
        scale:
          type: integer
        format:
          type: string
        start_value:
          type: integer
        relationship_name:
          type: string
        on_delete:
          type: string
          enum: [set_null, cascade, restrict]
        is_reparentable:
          type: boolean
        default_value:
          type: string
        default_expr:
          type: string
          description: CEL expression for dynamic default value
        default_on:
          type: string
          description: When to apply default (create, update, create,update)

    CreateValidationRuleRequest:
      type: object
      required:
        - api_name
        - label
        - expression
        - error_message
      properties:
        api_name:
          type: string
          minLength: 2
          maxLength: 100
        label:
          type: string
          minLength: 1
          maxLength: 255
        expression:
          type: string
          description: CEL expression that must return true for valid data
        error_message:
          type: string
          maxLength: 500
        error_code:
          type: string
          maxLength: 100
          default: validation_failed
        severity:
          type: string
          enum: [error, warning]
          default: error
        when_expression:
          type: string
          description: Optional CEL condition for when this rule applies
        applies_to:
          type: string
          default: "create,update"
        sort_order:
          type: integer
          default: 0
        is_active:
          type: boolean
          default: true
        description:
          type: string

    UpdateValidationRuleRequest:
      type: object
      required:
        - label
        - expression
        - error_message
      properties:
        label:
          type: string
          minLength: 1
          maxLength: 255
        expression:
          type: string
        error_message:
          type: string
          maxLength: 500
        error_code:
          type: string
        severity:
          type: string
          enum: [error, warning]
        when_expression:
          type: string
        applies_to:
          type: string
        sort_order:
          type: integer
        is_active:
          type: boolean
        description:
          type: string

    ValidationRule:
      type: object
      required:
        - id
        - object_id
        - api_name
        - label
        - description
        - expression
        - error_message
        - error_code
        - severity
        - applies_to
        - sort_order
        - is_active
        - created_at
        - updated_at
      properties:
        id:
          type: string
          format: uuid
        object_id:
          type: string
          format: uuid
        api_name:
          type: string
        label:
          type: string
        description:
          type: string
        expression:
          type: string
        error_message:
          type: string
        error_code:
          type: string
        severity:
          type: string
          enum: [error, warning]
        when_expression:
          type: string
          nullable: true
        applies_to:
          type: string
        sort_order:
          type: integer
        is_active:
          type: boolean
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    ValidationRuleResponse:
      type: object
      properties:
        data:
          $ref: "#/components/schemas/ValidationRule"

    ValidationRuleListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: "#/components/schemas/ValidationRule"

    FieldDefinitionSchema:
      type: object
      required:
        - id
        - object_id
        - api_name
        - label
        - description
        - help_text
        - field_type
        - is_required
        - is_unique
        - config
        - is_system_field
        - is_custom
        - is_platform_managed
        - sort_order
        - created_at
        - updated_at
      properties:
        id:
          type: string
          format: uuid
        object_id:
          type: string
          format: uuid
        api_name:
          type: string
        label:
          type: string
        description:
          type: string
        help_text:
          type: string
        field_type:
          type: string
          enum: [text, number, boolean, datetime, picklist, reference]
        field_subtype:
          type: string
          enum: [plain, area, rich, email, phone, url, integer, decimal, currency, percent, auto_number, date, datetime, time, single, multi, association, composition, polymorphic]
        referenced_object_id:
          type: string
          format: uuid
        is_required:
          type: boolean
        is_unique:
          type: boolean
        config:
          $ref: "#/components/schemas/FieldConfig"
        is_system_field:
          type: boolean
        is_custom:
          type: boolean
        is_platform_managed:
          type: boolean
        sort_order:
          type: integer
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    FieldResponse:
      type: object
      properties:
        data:
          $ref: "#/components/schemas/FieldDefinitionSchema"

    FieldListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: "#/components/schemas/FieldDefinitionSchema"

    SOQLRequest:
      type: object
      required:
        - query
      properties:
        query:
          type: string
          description: SOQL query string
          example: "SELECT Id, Name FROM Account LIMIT 10"
        pageSize:
          type: integer
          minimum: 1
          maximum: 2000
          default: 100
          description: Maximum number of records per page

    SOQLResult:
      type: object
      properties:
        totalSize:
          type: integer
          description: Total number of records returned
        done:
          type: boolean
          description: Whether all records have been returned
        records:
          type: array
          items:
            type: object
            additionalProperties: true
          description: Query result records
        nextRecordsUrl:
          type: string
          description: Cursor for fetching the next page (empty if done)

    DMLRequest:
      type: object
      required:
        - statement
      properties:
        statement:
          type: string
          description: DML statement string
          example: "INSERT INTO Account (Name, Industry) VALUES ('Acme', 'Technology')"

    DMLResult:
      type: object
      properties:
        rowsAffected:
          type: integer
          format: int64
          description: Number of rows affected
        insertedIds:
          type: array
          items:
            type: string
          description: IDs of inserted records
        updatedIds:
          type: array
          items:
            type: string
          description: IDs of updated records
        deletedIds:
          type: array
          items:
            type: string
          description: IDs of deleted records

    TemplateInfo:
      type: object
      properties:
        id:
          type: string
        label:
          type: string
        description:
          type: string
        status:
          type: string
          enum: [available, applied, blocked]
        objects:
          type: integer
        fields:
          type: integer

    TemplateListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: "#/components/schemas/TemplateInfo"

    TemplateApplyResponse:
      type: object
      properties:
        data:
          type: object
          properties:
            template_id:
              type: string
            message:
              type: string

    ObjectNavItem:
      type: object
      required:
        - api_name
        - label
        - plural_label
        - is_createable
        - is_queryable
      properties:
        api_name:
          type: string
        label:
          type: string
        plural_label:
          type: string
        is_createable:
          type: boolean
        is_queryable:
          type: boolean

    ObjectDescribe:
      type: object
      required:
        - api_name
        - label
        - plural_label
        - is_createable
        - is_updateable
        - is_deleteable
        - fields
      properties:
        api_name:
          type: string
        label:
          type: string
        plural_label:
          type: string
        is_createable:
          type: boolean
        is_updateable:
          type: boolean
        is_deleteable:
          type: boolean
        fields:
          type: array
          items:
            $ref: "#/components/schemas/FieldDescribe"
        form:
          $ref: "#/components/schemas/FormDescribe"

    FieldDescribe:
      type: object
      required:
        - api_name
        - label
        - field_type
        - is_required
        - is_read_only
        - is_system_field
        - sort_order
        - config
      properties:
        api_name:
          type: string
        label:
          type: string
        field_type:
          type: string
        field_subtype:
          type: string
          nullable: true
        is_required:
          type: boolean
        is_read_only:
          type: boolean
        is_system_field:
          type: boolean
        sort_order:
          type: integer
        config:
          type: object
          properties:
            max_length:
              type: integer
            precision:
              type: integer
            scale:
              type: integer
            default_value:
              type: string
            values:
              type: array
              items:
                type: object
                required:
                  - id
                  - value
                  - label
                  - sort_order
                  - is_default
                  - is_active
                properties:
                  id:
                    type: string
                  value:
                    type: string
                  label:
                    type: string
                  sort_order:
                    type: integer
                  is_default:
                    type: boolean
                  is_active:
                    type: boolean

    FormDescribe:
      type: object
      properties:
        sections:
          type: array
          items:
            $ref: "#/components/schemas/FormSection"
        highlight_fields:
          type: array
          items:
            type: string
        actions:
          type: array
          items:
            $ref: "#/components/schemas/FormAction"
        related_lists:
          type: array
          items:
            $ref: "#/components/schemas/FormRelatedList"
        list_fields:
          type: array
          items:
            type: string
        list_default_sort:
          type: string

    FormSection:
      type: object
      properties:
        key:
          type: string
        label:
          type: string
        columns:
          type: integer
        collapsed:
          type: boolean
        fields:
          type: array
          items:
            type: string

    FormAction:
      type: object
      properties:
        key:
          type: string
        label:
          type: string
        type:
          type: string
        icon:
          type: string
        visibility_expr:
          type: string

    FormRelatedList:
      type: object
      properties:
        object:
          type: string
        label:
          type: string
        fields:
          type: array
          items:
            type: string
        sort:
          type: string
        limit:
          type: integer

    PaginationMeta:
      type: object
      required:
        - page
        - per_page
        - total
        - total_pages
      properties:
        page:
          type: integer
        per_page:
          type: integer
        total:
          type: integer
          format: int64
        total_pages:
          type: integer
          format: int64

    ErrorBody:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: string
        message:
          type: string

    Function:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        params:
          type: array
          items:
            $ref: "#/components/schemas/FunctionParam"
        return_type:
          type: string
          enum: [string, number, boolean, list, map, any]
        body:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    FunctionParam:
      type: object
      required:
        - name
        - type
      properties:
        name:
          type: string
        type:
          type: string
          enum: [string, number, boolean, list, map, any]
        description:
          type: string

    CreateFunctionRequest:
      type: object
      required:
        - name
        - body
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 100
          pattern: "^[a-z][a-z0-9_]*$"
        description:
          type: string
        params:
          type: array
          items:
            $ref: "#/components/schemas/FunctionParam"
        return_type:
          type: string
          enum: [string, number, boolean, list, map, any]
        body:
          type: string
          maxLength: 4096

    UpdateFunctionRequest:
      type: object
      required:
        - body
      properties:
        description:
          type: string
        params:
          type: array
          items:
            $ref: "#/components/schemas/FunctionParam"
        return_type:
          type: string
          enum: [string, number, boolean, list, map, any]
        body:
          type: string
          maxLength: 4096

    ObjectView:
      type: object
      required:
        - id
        - api_name
        - label
        - description
        - config
        - created_at
        - updated_at
      properties:
        id:
          type: string
          format: uuid
        profile_id:
          type: string
          format: uuid
          nullable: true
        api_name:
          type: string
        label:
          type: string
        description:
          type: string
        config:
          $ref: "#/components/schemas/ObjectViewConfig"
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    ObjectViewConfig:
      type: object
      required:
        - read
      properties:
        read:
          $ref: "#/components/schemas/OVReadConfig"
        write:
          $ref: "#/components/schemas/OVWriteConfig"

    OVReadConfig:
      type: object
      properties:
        fields:
          type: array
          items:
            type: string
        actions:
          type: array
          items:
            $ref: "#/components/schemas/OVAction"
        queries:
          type: array
          items:
            $ref: "#/components/schemas/OVQuery"
        computed:
          type: array
          items:
            $ref: "#/components/schemas/OVReadComputed"

    OVWriteConfig:
      type: object
      properties:
        fields:
          type: array
          items:
            type: string
        validation:
          type: array
          items:
            $ref: "#/components/schemas/OVValidation"
        defaults:
          type: array
          items:
            $ref: "#/components/schemas/OVDefault"
        computed:
          type: array
          items:
            $ref: "#/components/schemas/OVComputed"
        mutations:
          type: array
          items:
            $ref: "#/components/schemas/OVMutation"

    OVAction:
      type: object
      required:
        - key
        - label
        - type
        - icon
        - visibility_expr
      properties:
        key:
          type: string
        label:
          type: string
        type:
          type: string
        icon:
          type: string
        visibility_expr:
          type: string

    OVQuery:
      type: object
      required:
        - name
        - soql
      properties:
        name:
          type: string
        soql:
          type: string
        when:
          type: string

    OVMutation:
      type: object
      required:
        - dml
      properties:
        dml:
          type: string
        foreach:
          type: string
        sync:
          $ref: "#/components/schemas/OVMutSync"
        when:
          type: string

    OVMutSync:
      type: object
      required:
        - key
        - value
      properties:
        key:
          type: string
        value:
          type: string

    OVReadComputed:
      type: object
      required:
        - name
        - type
        - expr
      properties:
        name:
          type: string
        type:
          type: string
          enum: [string, int, float, bool, timestamp]
        expr:
          type: string
        when:
          type: string

    OVValidation:
      type: object
      required:
        - expr
        - message
        - severity
      properties:
        expr:
          type: string
        message:
          type: string
        code:
          type: string
        severity:
          type: string
          enum: [error, warning]
        when:
          type: string

    OVDefault:
      type: object
      required:
        - field
        - expr
        - "on"
      properties:
        field:
          type: string
        expr:
          type: string
        "on":
          type: string
          enum: [create, update, "create,update"]
        when:
          type: string

    OVComputed:
      type: object
      required:
        - field
        - expr
      properties:
        field:
          type: string
        expr:
          type: string

    UpdateObjectViewRequest:
      type: object
      required:
        - label
      properties:
        label:
          type: string
          minLength: 1
        description:
          type: string
        config:
          $ref: "#/components/schemas/ObjectViewConfig"

    CelValidateRequest:
      type: object
      required:
        - expression
        - context
      properties:
        expression:
          type: string
        context:
          type: string
          enum: [validation_rule, when_expression, default_expr, function_body, visibility_expr]
        object_api_name:
          type: string
        params:
          type: array
          items:
            $ref: "#/components/schemas/CelParamDef"

    CelParamDef:
      type: object
      required:
        - name
        - type
      properties:
        name:
          type: string
        type:
          type: string

    CelValidateResponse:
      type: object
      required:
        - valid
      properties:
        valid:
          type: boolean
        return_type:
          type: string
        errors:
          type: array
          items:
            $ref: "#/components/schemas/CelValidateError"

    CelValidateError:
      type: object
      required:
        - message
      properties:
        message:
          type: string
        line:
          type: integer
        column:
          type: integer

    # ─── SOQL Validation schemas ───────────────────────────────

    SoqlValidateRequest:
      type: object
      required:
        - query
      properties:
        query:
          type: string

    SoqlValidateResponse:
      type: object
      required:
        - valid
      properties:
        valid:
          type: boolean
        object:
          type: string
        fields:
          type: array
          items:
            type: string
        errors:
          type: array
          items:
            $ref: "#/components/schemas/SoqlValidateError"

    SoqlValidateError:
      type: object
      required:
        - message
      properties:
        message:
          type: string
        line:
          type: integer
        column:
          type: integer
        code:
          type: string

    # ─── Profile Navigation schemas ────────────────────────────

    NavItem:
      type: object
      required:
        - type
      properties:
        type:
          type: string
          enum: [object, link, divider, page]
        object_api_name:
          type: string
        ov_api_name:
          type: string
        label:
          type: string
        url:
          type: string
        icon:
          type: string

    NavGroup:
      type: object
      required:
        - key
        - label
        - items
      properties:
        key:
          type: string
        label:
          type: string
        icon:
          type: string
        items:
          type: array
          items:
            $ref: "#/components/schemas/NavItem"

    NavConfig:
      type: object
      required:
        - groups
      properties:
        groups:
          type: array
          items:
            $ref: "#/components/schemas/NavGroup"

    ProfileNavigation:
      type: object
      required:
        - id
        - profile_id
        - config
        - created_at
        - updated_at
      properties:
        id:
          type: string
          format: uuid
        profile_id:
          type: string
          format: uuid
        config:
          $ref: "#/components/schemas/NavConfig"
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateProfileNavigationRequest:
      type: object
      required:
        - profile_id
      properties:
        profile_id:
          type: string
          format: uuid
        config:
          $ref: "#/components/schemas/NavConfig"

    UpdateProfileNavigationRequest:
      type: object
      properties:
        config:
          $ref: "#/components/schemas/NavConfig"

    ResolvedNavItem:
      type: object
      required:
        - type
      properties:
        type:
          type: string
          enum: [object, link, divider, page]
        object_api_name:
          type: string
        ov_api_name:
          type: string
        label:
          type: string
        plural_label:
          type: string
        url:
          type: string
        icon:
          type: string

    ResolvedNavGroup:
      type: object
      required:
        - key
        - label
        - items
      properties:
        key:
          type: string
        label:
          type: string
        icon:
          type: string
        items:
          type: array
          items:
            $ref: "#/components/schemas/ResolvedNavItem"

    ResolvedNavigation:
      type: object
      required:
        - groups
      properties:
        groups:
          type: array
          items:
            $ref: "#/components/schemas/ResolvedNavGroup"

    ErrorResponse:
      type: object
      required:
        - error
      properties:
        error:
          $ref: "#/components/schemas/ErrorBody"

  responses:
    BadRequest:
      description: Validation error
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    Unauthorized:
      description: Authentication required or invalid
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    Forbidden:
      description: Action not permitted
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    Conflict:
      description: Duplicate or conflict
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    InternalError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
